{% extends "base.html" %}

{% block title %}Bot Control - Granada OS Wabden{% endblock %}
{% block page_title %}Bot Control Center{% endblock %}
{% block page_subtitle %}Web scraping automation and intelligent bot management{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Bot Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="card-gradient rounded-xl p-6 hover-scale" data-aos="fade-up" data-aos-delay="100">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm uppercase tracking-wide">Active Bots</p>
                    <p class="text-3xl font-bold text-white mt-1">{{ active_bots }}</p>
                    <p class="text-cyan-400 text-sm mt-1">Currently running</p>
                </div>
                <div class="w-12 h-12 bg-cyan-500/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-robot text-cyan-400 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="card-gradient rounded-xl p-6 hover-scale" data-aos="fade-up" data-aos-delay="200">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm uppercase tracking-wide">Opportunities Found</p>
                    <p class="text-3xl font-bold text-white mt-1">{{ total_opportunities_found }}</p>
                    <p class="text-green-400 text-sm mt-1">Total discovered</p>
                </div>
                <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-bullseye text-green-400 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="card-gradient rounded-xl p-6 hover-scale" data-aos="fade-up" data-aos-delay="300">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm uppercase tracking-wide">Success Rate</p>
                    <p class="text-3xl font-bold text-white mt-1">94%</p>
                    <p class="text-purple-400 text-sm mt-1">Average performance</p>
                </div>
                <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-chart-line text-purple-400 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="card-gradient rounded-xl p-6 hover-scale" data-aos="fade-up" data-aos-delay="400">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm uppercase tracking-wide">Uptime</p>
                    <p class="text-3xl font-bold text-white mt-1">99.8%</p>
                    <p class="text-orange-400 text-sm mt-1">System availability</p>
                </div>
                <div class="w-12 h-12 bg-orange-500/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-server text-orange-400 text-xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot Management -->
    <div class="card-gradient rounded-xl p-6" data-aos="fade-up" data-aos-delay="500">
        <div class="flex space-x-1 mb-6">
            <button onclick="showBotTab('overview')" class="bot-tab-btn px-4 py-2 rounded-lg transition-all duration-300 bg-cyan-600 text-white">
                <i class="fas fa-tachometer-alt mr-2"></i> Overview
            </button>
            <button onclick="showBotTab('control')" class="bot-tab-btn px-4 py-2 rounded-lg transition-all duration-300 bg-gray-700 text-gray-300 hover:bg-gray-600">
                <i class="fas fa-play-circle mr-2"></i> Bot Control
            </button>
            <button onclick="showBotTab('targets')" class="bot-tab-btn px-4 py-2 rounded-lg transition-all duration-300 bg-gray-700 text-gray-300 hover:bg-gray-600">
                <i class="fas fa-crosshairs mr-2"></i> Target URLs
            </button>
            <button onclick="showBotTab('analytics')" class="bot-tab-btn px-4 py-2 rounded-lg transition-all duration-300 bg-gray-700 text-gray-300 hover:bg-gray-600">
                <i class="fas fa-chart-bar mr-2"></i> Analytics
            </button>
            <button onclick="showBotTab('logs')" class="bot-tab-btn px-4 py-2 rounded-lg transition-all duration-300 bg-gray-700 text-gray-300 hover:bg-gray-600">
                <i class="fas fa-list mr-2"></i> Activity Logs
            </button>
        </div>

        <!-- Overview Tab -->
        <div id="overview-tab" class="bot-tab-content">
            <h3 class="text-xl font-bold text-white mb-6">Bot Fleet Status</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h4 class="text-lg font-medium text-white mb-4">Active Bots</h4>
                    <div class="space-y-4">
                        {% for bot in bots %}
                        <div class="bg-gray-800/50 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h5 class="text-white font-medium">{{ bot[1] }}</h5>
                                    <p class="text-gray-400 text-sm">{{ bot[2] }} â€¢ Bot ID: {{ bot[0] }}</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    {% if bot[3] %}
                                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-green-400 text-sm">Active</span>
                                    {% else %}
                                    <div class="w-3 h-3 bg-gray-500 rounded-full"></div>
                                    <span class="text-gray-400 text-sm">Inactive</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-400">Runs</p>
                                    <p class="text-white font-medium">{{ bot[4] or 0 }}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Found</p>
                                    <p class="text-green-400 font-medium">{{ bot[5] or 0 }}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Success Rate</p>
                                    <p class="text-purple-400 font-medium">{{ "%.1f"|format(bot[7] or 0) }}%</p>
                                </div>
                            </div>
                            
                            <div class="flex space-x-2 mt-4">
                                {% if bot[3] %}
                                <button onclick="stopBot('{{ bot[0] }}')" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-xs transition-colors">
                                    <i class="fas fa-stop mr-1"></i> Stop
                                </button>
                                {% else %}
                                <button onclick="startBot('{{ bot[0] }}')" class="px-3 py-1 bg-green-600 hover:bg-green-700 rounded text-xs transition-colors">
                                    <i class="fas fa-play mr-1"></i> Start
                                </button>
                                {% endif %}
                                <button onclick="configureBot('{{ bot[0] }}')" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition-colors">
                                    <i class="fas fa-cog mr-1"></i> Configure
                                </button>
                                <button onclick="viewBotLogs('{{ bot[0] }}')" class="px-3 py-1 bg-gray-600 hover:bg-gray-700 rounded text-xs transition-colors">
                                    <i class="fas fa-eye mr-1"></i> Logs
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-medium text-white mb-4">Performance Metrics</h4>
                    <canvas id="botPerformanceChart" height="300"></canvas>
                    
                    <div class="mt-6 space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-400">Average Response Time</span>
                            <span class="text-blue-400">2.3s</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-400">Data Quality Score</span>
                            <span class="text-green-400">98.5%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-400">Daily Discoveries</span>
                            <span class="text-purple-400">{{ (total_opportunities_found / 30)|round|int }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot Control Tab -->
        <div id="control-tab" class="bot-tab-content hidden">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white">Bot Control Panel</h3>
                <div class="flex space-x-3">
                    <button onclick="runAllBots()" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
                        <i class="fas fa-play mr-2"></i> Run All Bots
                    </button>
                    <button onclick="stopAllBots()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors">
                        <i class="fas fa-stop mr-2"></i> Stop All Bots
                    </button>
                    <button onclick="openAddBotModal()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                        <i class="fas fa-plus mr-2"></i> Add Bot
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <h4 class="text-lg font-medium text-white mb-4">Bot Queue Management</h4>
                    <div class="bg-gray-800/50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-white font-medium">Processing Queue</span>
                            <span class="text-blue-400">5 tasks pending</span>
                        </div>
                        
                        <div class="space-y-3">
                            {% for i in range(5) %}
                            <div class="flex items-center justify-between p-3 bg-gray-700/50 rounded-lg">
                                <div>
                                    <p class="text-white text-sm">Scrape {{ ['ReliefWeb', 'UN Jobs', 'GrantSpace', 'EU Portal', 'Grants.gov'][i] }}</p>
                                    <p class="text-gray-400 text-xs">Priority: {{ ['High', 'Medium', 'Low'][i % 3] }}</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="px-2 py-1 bg-{{ 'orange' if i < 2 else 'blue' }}-500/20 text-{{ 'orange' if i < 2 else 'blue' }}-400 rounded-full text-xs">
                                        {{ 'Running' if i < 2 else 'Queued' }}
                                    </span>
                                    <button class="px-2 py-1 bg-red-600 hover:bg-red-700 rounded text-xs transition-colors">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-medium text-white mb-4">Quick Actions</h4>
                    <div class="space-y-3">
                        <button class="w-full p-4 bg-gradient-to-r from-green-600 to-green-700 rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-300 group">
                            <i class="fas fa-play text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium">Start Discovery</p>
                            <p class="text-xs opacity-80">Begin automated scraping</p>
                        </button>
                        
                        <button class="w-full p-4 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-300 group">
                            <i class="fas fa-sync text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium">Refresh Targets</p>
                            <p class="text-xs opacity-80">Update URL database</p>
                        </button>
                        
                        <button class="w-full p-4 bg-gradient-to-r from-purple-600 to-purple-700 rounded-lg hover:from-purple-700 hover:to-purple-800 transition-all duration-300 group">
                            <i class="fas fa-brain text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium">AI Analysis</p>
                            <p class="text-xs opacity-80">Deep content analysis</p>
                        </button>
                        
                        <button class="w-full p-4 bg-gradient-to-r from-orange-600 to-orange-700 rounded-lg hover:from-orange-700 hover:to-orange-800 transition-all duration-300 group">
                            <i class="fas fa-download text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="font-medium">Export Results</p>
                            <p class="text-xs opacity-80">Download discoveries</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Target URLs Tab -->
        <div id="targets-tab" class="bot-tab-content hidden">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white">Target URL Management</h3>
                <button onclick="openAddUrlModal()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                    <i class="fas fa-plus mr-2"></i> Add URL
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h4 class="text-lg font-medium text-white mb-4">Active Targets</h4>
                    <div class="space-y-3">
                        {% set target_urls = [
                            {'name': 'ReliefWeb API', 'url': 'https://api.reliefweb.int/v1/jobs', 'status': 'Active', 'last_check': '2 min ago'},
                            {'name': 'UN Jobs Portal', 'url': 'https://jobs.un.org/lbw/home.aspx', 'status': 'Active', 'last_check': '5 min ago'},
                            {'name': 'GrantSpace', 'url': 'https://grantspace.org/funders/', 'status': 'Active', 'last_check': '1 min ago'},
                            {'name': 'EU Funding Portal', 'url': 'https://ec.europa.eu/info/funding-tenders/', 'status': 'Paused', 'last_check': '1 hour ago'},
                            {'name': 'Grants.gov', 'url': 'https://www.grants.gov/search-grants', 'status': 'Active', 'last_check': '3 min ago'}
                        ] %}
                        
                        {% for target in target_urls %}
                        <div class="bg-gray-800/50 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="text-white font-medium">{{ target.name }}</h5>
                                <span class="px-2 py-1 bg-{{ 'green' if target.status == 'Active' else 'orange' }}-500/20 text-{{ 'green' if target.status == 'Active' else 'orange' }}-400 rounded-full text-xs">
                                    {{ target.status }}
                                </span>
                            </div>
                            <p class="text-gray-400 text-sm mb-2">{{ target.url }}</p>
                            <p class="text-gray-500 text-xs mb-3">Last checked: {{ target.last_check }}</p>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition-colors">
                                    <i class="fas fa-play mr-1"></i> Test
                                </button>
                                <button class="px-3 py-1 bg-green-600 hover:bg-green-700 rounded text-xs transition-colors">
                                    <i class="fas fa-edit mr-1"></i> Edit
                                </button>
                                <button class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-xs transition-colors">
                                    <i class="fas fa-trash mr-1"></i> Remove
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-medium text-white mb-4">URL Performance</h4>
                    <canvas id="urlPerformanceChart" height="300"></canvas>
                    
                    <div class="mt-6">
                        <h5 class="text-white font-medium mb-3">Top Performing URLs</h5>
                        <div class="space-y-2">
                            {% for i in range(3) %}
                            <div class="flex items-center justify-between p-2 bg-gray-800/30 rounded">
                                <span class="text-gray-300 text-sm">{{ ['ReliefWeb API', 'GrantSpace', 'UN Jobs'][i] }}</span>
                                <span class="text-green-400 text-sm">{{ [245, 189, 156][i] }} found</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="bot-tab-content hidden">
            <h3 class="text-xl font-bold text-white mb-6">Bot Analytics & Insights</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h4 class="text-lg font-medium text-white mb-4">Discovery Trends</h4>
                    <canvas id="discoveryTrendsChart" height="300"></canvas>
                </div>
                <div>
                    <h4 class="text-lg font-medium text-white mb-4">Bot Efficiency</h4>
                    <canvas id="botEfficiencyChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Activity Logs Tab -->
        <div id="logs-tab" class="bot-tab-content hidden">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white">Activity Logs</h3>
                <div class="flex space-x-3">
                    <select class="px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white text-sm">
                        <option value="">All Bots</option>
                        <option value="bot1">ReliefWeb Bot</option>
                        <option value="bot2">UN Jobs Bot</option>
                        <option value="bot3">GrantSpace Bot</option>
                    </select>
                    <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors text-sm">
                        <i class="fas fa-download mr-2"></i> Export Logs
                    </button>
                </div>
            </div>

            <div class="bg-gray-900 rounded-lg p-4 font-mono text-sm max-h-96 overflow-y-auto">
                <div class="space-y-1">
                    {% for i in range(20) %}
                    <div class="flex items-start space-x-3">
                        <span class="text-gray-500 text-xs">{{ (now() - timedelta(minutes=i*5)).strftime('%H:%M:%S') }}</span>
                        <span class="text-{{ ['blue', 'green', 'yellow', 'red'][i % 4] }}-400 text-xs">{{ ['INFO', 'SUCCESS', 'WARN', 'ERROR'][i % 4] }}</span>
                        <span class="text-gray-300 text-xs">
                            {% if i % 4 == 0 %}Bot started scraping {{ ['ReliefWeb', 'UN Jobs', 'GrantSpace'][i % 3] }}
                            {% elif i % 4 == 1 %}Found {{ 5 + (i % 10) }} new opportunities
                            {% elif i % 4 == 2 %}Rate limit detected, backing off for 30s
                            {% else %}Connection timeout, retrying...{% endif %}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Bot Modal -->
<div id="addBotModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md">
        <h3 class="text-xl font-bold text-white mb-4">Add New Bot</h3>
        <form class="space-y-4">
            <div>
                <label class="block text-gray-400 text-sm mb-2">Bot Name</label>
                <input type="text" required class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
            </div>
            <div>
                <label class="block text-gray-400 text-sm mb-2">Target Country</label>
                <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
                    <option value="KE">Kenya</option>
                    <option value="UG">Uganda</option>
                    <option value="SS">South Sudan</option>
                    <option value="TZ">Tanzania</option>
                    <option value="RW">Rwanda</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-400 text-sm mb-2">Bot Type</label>
                <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
                    <option value="general">General Scraper</option>
                    <option value="api">API Bot</option>
                    <option value="deep">Deep Web Crawler</option>
                    <option value="ai">AI-Enhanced</option>
                </select>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeAddBotModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg transition-colors">
                    Create Bot
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Add URL Modal -->
<div id="addUrlModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md">
        <h3 class="text-xl font-bold text-white mb-4">Add Target URL</h3>
        <form class="space-y-4">
            <div>
                <label class="block text-gray-400 text-sm mb-2">URL Name</label>
                <input type="text" required class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
            </div>
            <div>
                <label class="block text-gray-400 text-sm mb-2">Target URL</label>
                <input type="url" required class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
            </div>
            <div>
                <label class="block text-gray-400 text-sm mb-2">Scraping Method</label>
                <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
                    <option value="selenium">Selenium (JavaScript)</option>
                    <option value="requests">HTTP Requests</option>
                    <option value="api">API Endpoint</option>
                </select>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeAddUrlModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                    Add URL
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Bot tab functionality
function showBotTab(tabName) {
    document.querySelectorAll('.bot-tab-content').forEach(tab => tab.classList.add('hidden'));
    document.querySelectorAll('.bot-tab-btn').forEach(btn => {
        btn.classList.remove('bg-cyan-600', 'text-white');
        btn.classList.add('bg-gray-700', 'text-gray-300');
    });
    
    document.getElementById(tabName + '-tab').classList.remove('hidden');
    event.target.classList.remove('bg-gray-700', 'text-gray-300');
    event.target.classList.add('bg-cyan-600', 'text-white');
}

// Bot control functions
async function startBot(botId) {
    try {
        const response = await fetch(`/api/bots/${botId}/start`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        });
        
        if (response.ok) {
            location.reload();
        } else {
            alert('Error starting bot');
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
}

async function stopBot(botId) {
    try {
        const response = await fetch(`/api/bots/${botId}/stop`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        });
        
        if (response.ok) {
            location.reload();
        } else {
            alert('Error stopping bot');
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
}

function runAllBots() {
    if (confirm('Are you sure you want to start all bots?')) {
        alert('Starting all bots...');
        // Implementation would go here
    }
}

function stopAllBots() {
    if (confirm('Are you sure you want to stop all bots?')) {
        alert('Stopping all bots...');
        // Implementation would go here
    }
}

function configureBot(botId) {
    alert(`Configure bot ${botId} functionality would be implemented here`);
}

function viewBotLogs(botId) {
    // Switch to logs tab and filter by bot
    showBotTab('logs');
}

// Modal functions
function openAddBotModal() {
    document.getElementById('addBotModal').classList.remove('hidden');
    document.getElementById('addBotModal').classList.add('flex');
}

function closeAddBotModal() {
    document.getElementById('addBotModal').classList.add('hidden');
    document.getElementById('addBotModal').classList.remove('flex');
}

function openAddUrlModal() {
    document.getElementById('addUrlModal').classList.remove('hidden');
    document.getElementById('addUrlModal').classList.add('flex');
}

function closeAddUrlModal() {
    document.getElementById('addUrlModal').classList.add('hidden');
    document.getElementById('addUrlModal').classList.remove('flex');
}

// Charts
const botPerformanceCtx = document.getElementById('botPerformanceChart').getContext('2d');
const botPerformanceChart = new Chart(botPerformanceCtx, {
    type: 'line',
    data: {
        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
        datasets: [{
            label: 'Success Rate',
            data: [95, 97, 94, 96, 98, 95],
            borderColor: '#06B6D4',
            backgroundColor: 'rgba(6, 182, 212, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100,
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                    color: '#9CA3AF',
                    callback: function(value) {
                        return value + '%';
                    }
                }
            },
            x: {
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                    color: '#9CA3AF'
                }
            }
        }
    }
});

const urlPerformanceCtx = document.getElementById('urlPerformanceChart').getContext('2d');
const urlPerformanceChart = new Chart(urlPerformanceCtx, {
    type: 'doughnut',
    data: {
        labels: ['ReliefWeb', 'UN Jobs', 'GrantSpace', 'EU Portal', 'Grants.gov'],
        datasets: [{
            data: [245, 189, 156, 134, 98],
            backgroundColor: ['#06B6D4', '#8B5CF6', '#10B981', '#F59E0B', '#EF4444'],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    color: '#9CA3AF',
                    padding: 15
                }
            }
        }
    }
});

const discoveryTrendsCtx = document.getElementById('discoveryTrendsChart').getContext('2d');
const discoveryTrendsChart = new Chart(discoveryTrendsCtx, {
    type: 'bar',
    data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
            label: 'Opportunities Discovered',
            data: [45, 52, 38, 61, 48, 35, 29],
            backgroundColor: 'rgba(16, 185, 129, 0.6)',
            borderColor: '#10B981',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                    color: '#9CA3AF'
                }
            },
            x: {
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                },
                ticks: {
                    color: '#9CA3AF'
                }
            }
        }
    }
});

const botEfficiencyCtx = document.getElementById('botEfficiencyChart').getContext('2d');
const botEfficiencyChart = new Chart(botEfficiencyCtx, {
    type: 'radar',
    data: {
        labels: ['Speed', 'Accuracy', 'Coverage', 'Reliability', 'Quality'],
        datasets: [{
            label: 'Bot Performance',
            data: [85, 92, 78, 96, 89],
            borderColor: '#8B5CF6',
            backgroundColor: 'rgba(139, 92, 246, 0.2)',
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            r: {
                beginAtZero: true,
                max: 100,
                grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                },
                pointLabels: {
                    color: '#9CA3AF'
                },
                ticks: {
                    color: '#9CA3AF',
                    backdropColor: 'transparent'
                }
            }
        }
    }
});

// Close modals on outside click
document.getElementById('addBotModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeAddBotModal();
    }
});

document.getElementById('addUrlModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeAddUrlModal();
    }
});
</script>
{% endblock %}